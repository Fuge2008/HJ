package com.haoji.haoji.ui;

import android.os.Bundle;
import android.support.annotation.NonNull;
import android.support.v4.view.ViewPager;
import android.support.v7.app.AppCompatActivity;
import android.view.Window;
import android.view.WindowManager;

import com.haoji.haoji.R;
import com.haoji.haoji.adapter.VerticalViewPagerAdapter;
import com.haoji.haoji.custom.VerticalViewPager;
import com.scwang.smartrefresh.layout.SmartRefreshLayout;
import com.scwang.smartrefresh.layout.api.RefreshLayout;
import com.scwang.smartrefresh.layout.listener.OnRefreshLoadMoreListener;

import java.util.ArrayList;
import java.util.List;

import butterknife.BindView;
import butterknife.ButterKnife;

public class VideoListAcitivity extends AppCompatActivity {

        @BindView(R.id.vvp_back_play)
        VerticalViewPager vvpBackPlay;
        @BindView(R.id.srl_page)
        SmartRefreshLayout srlPage;
        private List<String> urlList;
        private VerticalViewPagerAdapter pagerAdapter;

        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            this.requestWindowFeature(Window.FEATURE_NO_TITLE);
            this.getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN,
                    WindowManager.LayoutParams.FLAG_FULLSCREEN);
            setContentView(R.layout.activity_video_list_acitivity);
            ButterKnife.bind(this);
            initView();
            addListener();
        }

        private void addListener() {
            srlPage.setEnableAutoLoadMore(false);
            srlPage.setEnableLoadMore(false);
            srlPage.setOnRefreshLoadMoreListener(new OnRefreshLoadMoreListener() {
                @Override
                public void onLoadMore(@NonNull RefreshLayout refreshLayout) {
                    srlPage.postDelayed(new Runnable() {
                        @Override
                        public void run() {
                            urlList.addAll(urlList);
                            pagerAdapter.setUrlList(urlList);
                            pagerAdapter.notifyDataSetChanged();

                            srlPage.finishLoadMore();
                        }
                    }, 2000);

                }

                @Override
                public void onRefresh(@NonNull RefreshLayout refreshLayout) {

                }
            });
        }

        private void initView() {
            makeData();
            pagerAdapter = new VerticalViewPagerAdapter(getSupportFragmentManager());
            vvpBackPlay.setVertical(true);
            vvpBackPlay.setOffscreenPageLimit(10);
            pagerAdapter.setUrlList(urlList);
            vvpBackPlay.setAdapter(pagerAdapter);
            vvpBackPlay.addOnPageChangeListener(new ViewPager.OnPageChangeListener() {
                @Override
                public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {

                }

                @Override
                public void onPageSelected(int position) {
                    if (position == urlList.size() - 1) {
                        srlPage.setEnableAutoLoadMore(true);
                        srlPage.setEnableLoadMore(true);
                    } else {
                        srlPage.setEnableAutoLoadMore(false);
                        srlPage.setEnableLoadMore(false);
                    }

                }

                @Override
                public void onPageScrollStateChanged(int state) {

                }
            });


        }

        private void makeData() {
            urlList = new ArrayList<>();
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201805/100651/201805181532123423.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803151735198462.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803150923220770.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803150922255785.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803150920130302.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803141625005241.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803141624378522.mp4");
            urlList.add("http://chuangfen.oss-cn-hangzhou.aliyuncs.com/public/attachment/201803/100651/201803131546119319.mp4");
        }
    }


